/*
 * ngComboDatePicker v1.0.0
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * License: LGPLv3 (http://www.gnu.org/licenses/lgpl-3.0.html)
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@",ngAttrsDate:"@",ngAttrsMonth:"@",ngAttrsYear:"@"},controller:["$scope",function(e){function t(e){var t=null;return void 0!==e&&null!==e&&(e instanceof Date?t=e:("number"==typeof e||"string"==typeof e)&&(t=new Date(isNaN(e)?e:parseInt(e,10)))),t}function n(e,t){var n=31;return(4==e||6==e||9==e||11==e)&&(n=30),2==e&&(n=t%4==0&&t%100!=0?29:28),n}function a(e){var t=null;if(null!=e){try{t=JSON.parse(e)}catch(n){}if(null==t)try{t=JSON.parse(e.replace(/'/g,'"'))}catch(n){}}return t}e.ngModel=t(e.ngModel),null==e.ngModel&&(e.ngModel=new Date),e.ngAttrsDate=a(e.ngAttrsDate),e.ngAttrsMonth=a(e.ngAttrsMonth),e.ngAttrsYear=a(e.ngAttrsYear);var g=t(e.ngDate);if(null!=g&&(e.ngModel=g),"string"!=typeof e.ngOrder?e.ngOrder="dmy":e.ngOrder=e.ngOrder.toLowerCase(),e.minDate=t(e.ngMinDate),null==e.ngMinDate){var o=new Date;e.minDate=new Date(o.getFullYear()-100,o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds())}e.maxDate=t(e.ngMaxDate),null==e.maxDate&&(e.maxDate=new Date),e.ngModel<e.minDate&&(e.ngModel=e.minDate),e.ngModel>e.maxDate&&(e.ngModel=e.maxDate),e.years=[];for(var r=e.minDate.getFullYear();r<=e.maxDate.getFullYear();r++)e.years.push(r);var l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==e.ngMonths&&null!==e.ngMonths){if("string"==typeof e.ngMonths){var s=e.ngMonths.split(",");12==s.length&&(l=s)}Array.isArray(e.ngMonths)&&12==e.ngMonths.length&&(l=e.ngMonths)}e.updateMonthList=function(){var t=e.ngModel.getFullYear()==e.minDate.getFullYear()?e.minDate.getMonth():0,n=e.ngModel.getFullYear()==e.maxDate.getFullYear()?e.maxDate.getMonth():11;e.months=[];for(var a=t;n>=a;a++)e.months.push({index:a,name:l[a]})},e.updateDateList=function(){var t=1;e.ngModel.getMonth()==e.minDate.getMonth()&&e.ngModel.getFullYear()==e.minDate.getFullYear()&&(t=e.minDate.getDate());var a=n(e.ngModel.getMonth()+1,e.ngModel.getFullYear());e.ngModel.getMonth()==e.maxDate.getMonth()&&e.ngModel.getFullYear()==e.maxDate.getFullYear()&&(a=e.maxDate.getDate()),e.dates=[];for(var g=t;a>=g;g++)e.dates.push(g)},e.modelUpdated=function(){e.date=e.ngModel.getDate(),e.month=e.ngModel.getMonth(),e.year=e.ngModel.getFullYear(),e.updateMonthList(),e.updateDateList()},e.$watch("ngModel",function(){e.modelUpdated()}),e.onChange=function(t){var a=n(e.month+1,e.year);e.ngModel=new Date(e.year,e.month,e.date>a?a:e.date,e.ngModel.getHours(),e.ngModel.getMinutes(),e.ngModel.getSeconds(),e.ngModel.getMilliseconds()),e.updateMonthList(),e.updateDateList()},e.getSomething=function(){return"color:red;"}}],link:function(e,t,n){var a=angular.element,g=a(t[0]).children(),o=e.ngOrder.split("");null!=e.ngAttrsDate&&a(g[0]).attr(e.ngAttrsDate),null!=e.ngAttrsMonth&&a(g[1]).attr(e.ngAttrsMonth),null!=e.ngAttrsYear&&a(g[2]).attr(e.ngAttrsYear);for(var r=0;r<o.length;r++)"d"==o[r]&&a(t[0]).append(g[0]),"m"==o[r]&&a(t[0]).append(g[1]),"y"==o[r]&&a(t[0]).append(g[2])},template:function(){var e='<select ng-model="date" ng-change="onChange(\'date\')" ng-options="date for date in dates"></select><select ng-model="month" ng-change="onChange(\'month\')" ng-options="month.index as month.name for month in months"></select><select ng-model="year" ng-change="onChange(\'year\')" ng-options="year for year in years"></select>';return e}}});
